{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4>Тикет #{{ ticket.id }}: {{ ticket.title }}</h4>
            <span class="badge
                {% if ticket.status == 'open' %}bg-warning
                {% elif ticket.status == 'in_progress' %}bg-info
                {% elif ticket.status == 'resolved' %}bg-success
                {% else %}bg-secondary{% endif %}">
                {% if ticket.status == 'open' %}Открыт
                {% elif ticket.status == 'in_progress' %}В работе
                {% elif ticket.status == 'resolved' %}Решен
                {% else %}Отменен{% endif %}
            </span>
        </div>

        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5>Информация о тикете</h5>
                    <p><strong>Описание:</strong> {{ ticket.description }}</p>
                    <p><strong>Приоритет:</strong>
                        <span class="badge
                            {% if ticket.priority == 'low' %}bg-secondary
                            {% elif ticket.priority == 'medium' %}bg-primary
                            {% elif ticket.priority == 'high' %}bg-warning
                            {% else %}bg-danger{% endif %}">
                            {% if ticket.priority == 'low' %}Низкий
                            {% elif ticket.priority == 'medium' %}Средний
                            {% elif ticket.priority == 'high' %}Высокий
                            {% else %}Критический{% endif %}
                        </span>
                    </p>
                    <p><strong>Создан:</strong> {{ ticket.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                    <p><strong>Автор:</strong> {{ ticket.user_id.first_name }} {{ ticket.user_id.last_name }}</p>
                </div>

                <div class="col-md-6">
                    <h5>Информация о компьютере</h5>
                    <p><strong>Имя ПК:</strong> {{ ticket.computer_id.pc_name }}</p>
                    <p><strong>IP адрес:</strong> {{ ticket.computer_id.ip_address }}</p>
                    <p><strong>ОС:</strong> {{ ticket.computer_id.operating_system }}</p>
                </div>
            </div>

            {% if current_user.role_id.name in ['admin', 'sysadmin'] %}
            <hr>
            <h5>Управление тикетом</h5>
            <form method="POST" action="/ticket/{{ ticket.id }}/update_status">
                <div class="row">
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label class="form-label">Статус</label>
                            <select class="form-select" name="status">
                                <option value="open" {% if ticket.status == 'open' %}selected{% endif %}>Открыт</option>
                                <option value="in_progress" {% if ticket.status == 'in_progress' %}selected{% endif %}>В работе</option>
                                <option value="resolved" {% if ticket.status == 'resolved' %}selected{% endif %}>Решен</option>
                                <option value="cancelled" {% if ticket.status == 'cancelled' %}selected{% endif %}>Отменен</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label class="form-label">Приоритет</label>
                            <select class="form-select" name="priority">
                                <option value="low" {% if ticket.priority == 'low' %}selected{% endif %}>Низкий</option>
                                <option value="medium" {% if ticket.priority == 'medium' %}selected{% endif %}>Средний</option>
                                <option value="high" {% if ticket.priority == 'high' %}selected{% endif %}>Высокий</option>
                                <option value="critical" {% if ticket.priority == 'critical' %}selected{% endif %}>Критический</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-primary w-100">Обновить</button>
                        </div>
                    </div>
                </div>
            </form>
            {% endif %}
        </div>
    </div>

    <div class="mt-3">
        <a href="/sysadmin" class="btn btn-secondary">← Назад к дашборду</a>
    </div>
</div>
{% endblock %}